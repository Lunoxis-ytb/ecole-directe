<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EDMM - Ecole Direct Mais Mieux</title>
  <!-- PWA -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#0a0e1a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="EDMM">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  <link rel="icon" type="image/png" href="/icons/icon-192.png">
  <!-- Fonts & styles -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <meta name="mobile-web-app-capable" content="yes">
</head>
<body>

  <!-- ══ LOGIN ══ -->
  <div id="login-page" class="page active">
    <div class="login-container">
      <h1>EDMM</h1>
      <p class="login-subtitle">Ecole Direct Mais Mieux</p>
      <form id="login-form">
        <div class="input-group">
          <label for="username">Identifiant</label>
          <input type="text" id="username" autocomplete="username" required>
        </div>
        <div class="input-group">
          <label for="password">Mot de passe</label>
          <div class="password-wrapper">
            <input type="password" id="password" autocomplete="current-password" required>
            <button type="button" id="toggle-password" class="btn-eye" title="Afficher le mot de passe">&#128065;</button>
          </div>
        </div>
        <button type="submit" id="login-btn">Se connecter</button>
        <p id="login-error" class="error-msg"></p>
      </form>
    </div>
  </div>

  <!-- ══ DOUBLE AUTH (QCM) ══ -->
  <div id="doubleauth-page" class="page">
    <div class="login-container">
      <h1>Verification</h1>
      <p class="login-subtitle" id="da-question">Double authentification requise</p>
      <form id="doubleauth-form">
        <div id="da-propositions" class="da-propositions"></div>
        <input type="hidden" id="da-choix" value="">
        <button type="submit" id="da-btn" disabled>Valider</button>
        <p id="da-error" class="error-msg"></p>
      </form>
    </div>
  </div>

  <!-- ══ DASHBOARD ══ -->
  <div id="dashboard-page" class="page">

    <!-- Header -->
    <header class="dashboard-header">
      <div class="header-left">
        <h1>Dashboard</h1>
        <span id="student-name" class="student-name"></span>
      </div>
      <button id="logout-btn" class="btn-logout">Deconnexion</button>
    </header>

    <!-- Stats bar -->
    <div class="stats-bar">
      <div class="stat-card">
        <span class="stat-label">Moyenne generale</span>
        <span class="stat-value" id="stat-avg">--</span>
      </div>
      <div class="stat-card">
        <span class="stat-label">Moyenne classe</span>
        <span class="stat-value" id="stat-class-avg">--</span>
      </div>
      <div class="stat-card">
        <span class="stat-label">Rang classe</span>
        <span class="stat-value" id="stat-rank">--</span>
      </div>
      <div class="stat-card">
        <span class="stat-label">Devoirs a faire</span>
        <span class="stat-value" id="stat-homework">--</span>
      </div>
      <div class="stat-card">
        <span class="stat-label">Prochain cours</span>
        <span class="stat-value" id="stat-next-class">--</span>
      </div>
      <div class="stat-card">
        <span class="stat-label">Absences non just.</span>
        <span class="stat-value" id="stat-absences">--</span>
      </div>
    </div>

    <!-- Navigation tabs -->
    <nav class="tabs">
      <button class="tab active" data-tab="grades"><span class="tab-full">Notes</span><span class="tab-short">Notes</span></button>
      <button class="tab" data-tab="homework"><span class="tab-full">Devoirs</span><span class="tab-short">Devoirs</span></button>
      <button class="tab" data-tab="schedule"><span class="tab-full">Emploi du temps</span><span class="tab-short">EDT</span></button>
      <button class="tab" data-tab="viescolaire"><span class="tab-full">Vie Scolaire</span><span class="tab-short">Vie Scol.</span></button>
      <button class="tab" data-tab="messages"><span class="tab-full">Messages</span><span class="tab-short">Msgs</span></button>
    </nav>

    <!-- Tab content -->
    <main class="tab-content">

      <!-- Notes -->
      <section id="tab-grades" class="tab-panel active">
        <div class="panel-header">
          <h2>Notes par matiere</h2>
          <select id="trimester-select">
            <option value="A001">Semestre 1</option>
            <option value="A002">Semestre 2</option>
          </select>
        </div>
        <div id="grades-container" class="grades-container">
          <p class="loading">Chargement des notes...</p>
        </div>
        <div class="charts-grid">
          <div class="chart-section">
            <div class="chart-header">
              <h3>Mon evolution</h3>
              <select id="chart-subject-select">
                <option value="">Toutes matieres</option>
              </select>
            </div>
            <div class="chart-wrapper">
              <canvas id="grades-chart"></canvas>
            </div>
          </div>
        </div>
      </section>

      <!-- Devoirs -->
      <section id="tab-homework" class="tab-panel">
        <div class="panel-header">
          <h2>Cahier de texte</h2>
        </div>
        <div id="homework-container" class="homework-container">
          <p class="loading">Chargement des devoirs...</p>
        </div>
      </section>

      <!-- Emploi du temps -->
      <section id="tab-schedule" class="tab-panel">
        <div class="panel-header">
          <h2>Emploi du temps</h2>
          <div class="week-nav">
            <button id="prev-week" class="btn-nav">&larr; Semaine prec.</button>
            <span id="week-label">--</span>
            <button id="next-week" class="btn-nav">Semaine suiv. &rarr;</button>
          </div>
        </div>
        <div id="schedule-container" class="schedule-container">
          <p class="loading">Chargement de l'emploi du temps...</p>
        </div>
      </section>

      <!-- Vie Scolaire -->
      <section id="tab-viescolaire" class="tab-panel">
        <div class="panel-header">
          <h2>Vie Scolaire</h2>
        </div>
        <div id="viescolaire-container" class="viescolaire-container">
          <p class="loading">Chargement de la vie scolaire...</p>
        </div>
      </section>

      <!-- Messages -->
      <section id="tab-messages" class="tab-panel">
        <div class="panel-header">
          <h2>Messagerie</h2>
        </div>
        <div id="messages-container" class="messages-container">
          <p class="loading">Chargement des messages...</p>
        </div>
      </section>

    </main>
  </div>

  <script src="/js/api.js"></script>
  <script src="/js/grades.js"></script>
  <script src="/js/homework.js"></script>
  <script src="/js/schedule.js"></script>
  <script src="/js/viescolaire.js"></script>
  <script src="/js/messages.js"></script>
  <script src="/js/app.js"></script>
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/sw.js").then(() => {
        console.log("[PWA] Service Worker enregistre");
      });
    }
  </script>
</body>
</html>
